<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monitor del Sistema</title>
  <link rel="stylesheet" href="dise√±o.css">
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <style>
    /* Modo desactivado (sin fondo Matrix) */
    body.no-matrix .matrix-bg {
      display: none;
    }
    body.no-matrix {
      background: #111;
      color: #ddd;
      transition: all 0.5s ease;
    }
    body.no-matrix .container {
      background: rgba(50, 50, 50, 0.85);
      border: 2px solid #444;
      box-shadow: 0 0 10px #000;
    }
    body.no-matrix h1 {
      color: #fff;
      text-shadow: none;
    }

    /* Nuevos estilos para informaci√≥n detallada */
    .detailed-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    .info-card {
      background: rgba(20, 20, 40, 0.8);
      border: 1px solid #00fff7;
      border-radius: 8px;
      padding: 15px;
      font-size: 0.9rem;
    }
    
    .info-card h4 {
      margin: 0 0 10px 0;
      color: #00fff7;
      border-bottom: 1px solid #333;
      padding-bottom: 5px;
    }
    
    .info-item {
      display: flex;
      justify-content: space-between;
      margin: 8px 0;
      padding: 4px 0;
      border-bottom: 1px dashed #333;
    }
    
    .info-label {
      color: #aaa;
    }
    
    .info-value {
      color: #fff;
      font-weight: bold;
    }
    
    .storage-bar, .memory-bar {
      height: 8px;
      background: #333;
      border-radius: 4px;
      margin: 5px 0;
      overflow: hidden;
    }
    
    .storage-fill, .memory-fill {
      height: 100%;
      background: linear-gradient(90deg, #00fff7, #0099ff);
      border-radius: 4px;
    }
  </style>
</head>
<body class="no-matrix">
  <!-- Fondo Matrix -->
  <canvas class="matrix-bg"></canvas>
  <script>
    // ======= EFECTO MATRIX =======
    const canvas = document.querySelector('.matrix-bg');
    const ctx = canvas.getContext('2d');
    let w, h, cols, ypos;
    const letters = '„Ç¢„Ç°„Ç§„Ç£„Ç¶„É¥„Ç®„Çß„Ç™„Ç´„Ç¨„Ç≠„ÇÆ„ÇØ„Ç∞„Ç±„Ç≤„Ç≥„Ç¥„Çµ„Ç∂„Ç∑„Ç∏„Çπ„Ç∫„Çª„Çº„ÇΩ„Çæ„Çø„ÉÄ„ÉÅ„ÉÇ„ÉÉ„ÉÑ„ÉÖ„ÉÜ„Éá„Éà„Éâ„Éä„Éã„Éå„Éç„Éé„Éè„Éê„Éë„Éí„Éì„Éî„Éï„Éñ„Éó„Éò„Éô„Éö„Éõ„Éú„Éù„Éû„Éü„É†„É°„É¢„É§„É¶„É®„É©„É™„É´„É¨„É≠„ÉØ„É≤„É≥ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';

    function resize() {
      w = window.innerWidth;
      h = window.innerHeight;
      canvas.width = w;
      canvas.height = h;
      cols = Math.floor(w / 20);
      ypos = Array(cols).fill(0);
    }
    window.addEventListener('resize', resize);
    resize();

    function matrix() {
      ctx.fillStyle = 'rgba(15,0,38,0.15)';
      ctx.fillRect(0, 0, w, h);
      ctx.font = '18px monospace';
      for (let i = 0; i < cols; i++) {
        const text = letters[Math.floor(Math.random() * letters.length)];
        ctx.fillStyle = '#00fff7';
        ctx.fillText(text, i * 20, ypos[i] * 20);
        if (Math.random() > 0.975) ypos[i] = 0;
        else ypos[i]++;
      }
    }
    setInterval(matrix, 50);
  </script>

  <!-- Pantalla de inicio de sesi√≥n -->
  <div id="login-screen" style="display:block;">
    <div class="container">
      <h1>üîí Iniciar Sesi√≥n</h1>
      <input type="text" id="user" placeholder="Usuario">
      <input type="password" id="pass" placeholder="Contrase√±a">
      <button id="login-btn">Ingresar</button>
      <div id="login-error" style="color:#ff00cc;margin-top:10px;"></div>
    </div>
  </div>

  <!-- Pantalla de servidores -->
  <div id="servers-screen" style="display:none;">
    <div class="container">
      <h1>üü¢ Servidores</h1>
      <div class="stats-grid">
        <div class="stat-card" id="server1-card" style="cursor:pointer;">
          <h3>Servidor Principal</h3>
          <div id="server1-status" style="font-size:1.2rem;">Estado: <span style="color:#888;">Verificando...</span></div>
        </div>
        <div class="stat-card" id="server2-card" style="cursor:pointer;">
          <h3>Servidor Secundario</h3>
          <div id="server2-status" style="font-size:1.2rem;">Estado: <span style="color:#888;">Verificando...</span></div>
        </div>
      </div>
      <button id="logout-btn1" style="margin-top:24px;">Cerrar sesi√≥n</button>
    </div>
  </div>

  <!-- Monitor del sistema -->
  <div class="container" id="monitor-screen" style="display:none;">
    <h1 id="monitor-title">üñ•Ô∏è Monitor del Sistema en Tiempo Real</h1>
    
    <!-- M√©tricas en Tiempo Real -->
    <div class="stats-grid">
      <div class="stat-card">
        <h3>CPU</h3>
        <div class="progress-bar"><div class="progress-fill" id="cpu-bar" style="width: 0%"></div></div>
        <span id="cpu-text">0%</span>
      </div>
      <div class="stat-card">
        <h3>Memoria</h3>
        <div class="progress-bar"><div class="progress-fill" id="mem-bar" style="width: 0%"></div></div>
        <span id="mem-text">0%</span>
      </div>
      <div class="stat-card">
        <h3>Temperatura</h3>
        <div id="temp-text">0¬∞C</div>
      </div>
    </div>

    <!-- Informaci√≥n Detallada del Sistema -->
    <div class="detailed-grid">
      <!-- Informaci√≥n del Sistema -->
      <div class="info-card">
        <h4>üñ•Ô∏è Informaci√≥n del Sistema</h4>
        <div class="info-item">
          <span class="info-label">Placa Madre:</span>
          <span class="info-value" id="motherboard">Cargando...</span>
        </div>
        <div class="info-item">
          <span class="info-label">BIOS:</span>
          <span class="info-value" id="bios">Cargando...</span>
        </div>
        <div class="info-item">
          <span class="info-label">Sistema Operativo:</span>
          <span class="info-value" id="os">Cargando...</span>
        </div>
        <div class="info-item">
          <span class="info-label">Arquitectura:</span>
          <span class="info-value" id="architecture">Cargando...</span>
        </div>
        <div class="info-item">
          <span class="info-label">Tiempo Activo:</span>
          <span class="info-value" id="uptime">Cargando...</span>
        </div>
      </div>

      <!-- Informaci√≥n del CPU -->
      <div class="info-card">
        <h4>‚ö° Procesador</h4>
        <div class="info-item">
          <span class="info-label">Modelo:</span>
          <span class="info-value" id="cpu-model">Cargando...</span>
        </div>
        <div class="info-item">
          <span class="info-label">N√∫cleos:</span>
          <span class="info-value" id="cpu-cores">Cargando...</span>
        </div>
        <div class="info-item">
          <span class="info-label">Frecuencia:</span>
          <span class="info-value" id="cpu-speed">Cargando...</span>
        </div>
        <div class="info-item">
          <span class="info-label">Temperatura:</span>
          <span class="info-value" id="cpu-temp">Cargando...</span>
        </div>
      </div>

      <!-- Informaci√≥n de Memoria -->
      <div class="info-card">
        <h4>üíæ Memoria RAM</h4>
        <div class="info-item">
          <span class="info-label">Total:</span>
          <span class="info-value" id="ram-total">Cargando...</span>
        </div>
        <div class="info-item">
          <span class="info-label">En Uso:</span>
          <span class="info-value" id="ram-used">Cargando...</span>
        </div>
        <div class="info-item">
          <span class="info-label">Tipo:</span>
          <span class="info-value" id="ram-type">Cargando...</span>
        </div>
        <div class="info-item">
          <span class="info-label">Frecuencia:</span>
          <span class="info-value" id="ram-speed">Cargando...</span>
        </div>
        <div class="memory-bar">
          <div class="memory-fill" id="ram-bar" style="width: 0%"></div>
        </div>
      </div>

      <!-- Almacenamiento -->
      <div class="info-card">
        <h4>üíø Almacenamiento</h4>
        <div id="storage-info">
          <div class="info-item">
            <span class="info-label">Cargando discos...</span>
          </div>
        </div>
      </div>

      <!-- GPU -->
      <div class="info-card">
        <h4>üéÆ Gr√°ficos</h4>
        <div class="info-item">
          <span class="info-label">Modelo:</span>
          <span class="info-value" id="gpu-model">Cargando...</span>
        </div>
        <div class="info-item">
          <span class="info-label">VRAM:</span>
          <span class="info-value" id="gpu-vram">Cargando...</span>
        </div>
        <div class="info-item">
          <span class="info-label">Uso:</span>
          <span class="info-value" id="gpu-usage">Cargando...</span>
        </div>
      </div>

      <!-- Red -->
      <div class="info-card">
        <h4>üåê Red</h4>
        <div class="info-item">
          <span class="info-label">Direcci√≥n IP:</span>
          <span class="info-value" id="ip-address">Cargando...</span>
        </div>
        <div class="info-item">
          <span class="info-label">Subida:</span>
          <span class="info-value" id="network-upload">0 KB/s</span>
        </div>
        <div class="info-item">
          <span class="info-label">Bajada:</span>
          <span class="info-value" id="network-download">0 KB/s</span>
        </div>
      </div>
    </div>

    <div class="connection-status"><span id="status">Conectando...</span></div>
    <button id="back-btn" style="margin-top:24px;">Volver</button>
    <button id="logout-btn2" style="margin-top:12px;">Cerrar sesi√≥n</button>
  </div>

  <script>
    // ======= LOGIN & SERVIDORES =======
    function actualizarEstadoServidor() {
      // Servidor Principal
      document.getElementById('server1-status').innerHTML =
        `Estado: <span style="color:#888;">Verificando...</span>`;
      fetch('http://localhost:3000/api/sistema')
        .then(res => res.ok ? res.json() : Promise.reject())
        .then(() => document.getElementById('server1-status').innerHTML =
          `Estado: <span style="color:#00fff7;">Prendido</span>`)
        .catch(() => document.getElementById('server1-status').innerHTML =
          `Estado: <span style="color:#ff00cc;">Apagado</span>`);

      // Secundario
      document.getElementById('server2-status').innerHTML =
        `Estado: <span style="color:#888;">Verificando...</span>`;
      fetch('http://localhost:3001/api/sistema')
        .then(res => res.ok ? res.json() : Promise.reject())
        .then(() => document.getElementById('server2-status').innerHTML =
          `Estado: <span style="color:#00fff7;">Prendido</span>`)
        .catch(() => document.getElementById('server2-status').innerHTML =
          `Estado: <span style="color:#ff00cc;">Apagado</span>`);
    }

    document.getElementById('login-btn').onclick = function() {
      const user = document.getElementById('user').value;
      const pass = document.getElementById('pass').value;
      if (user === 'admintic' && pass === 'admintic') {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('servers-screen').style.display = 'block';
        actualizarEstadoServidor();
      } else {
        document.getElementById('login-error').textContent = 'Credenciales incorrectas';
      }
    };

    document.getElementById('pass').addEventListener('keydown', e => {
      if (e.key === 'Enter') document.getElementById('login-btn').click();
    });

    let servidorActual = 1;
    document.getElementById('server1-card').onclick = () => {
      servidorActual = 1;
      document.getElementById('monitor-title').textContent = 'üñ•Ô∏è Monitor del Servidor Principal';
      document.getElementById('servers-screen').style.display = 'none';
      document.getElementById('monitor-screen').style.display = 'block';
      conectarSocket();
    };
    document.getElementById('server2-card').onclick = () => {
      servidorActual = 2;
      document.getElementById('monitor-title').textContent = 'üñ•Ô∏è Monitor del Servidor Secundario';
      document.getElementById('servers-screen').style.display = 'none';
      document.getElementById('monitor-screen').style.display = 'block';
      conectarSocket();
    };

    document.getElementById('back-btn').onclick = () => {
      document.getElementById('monitor-screen').style.display = 'none';
      document.getElementById('servers-screen').style.display = 'block';
      actualizarEstadoServidor();
      desconectarSocket();
    };
    document.getElementById('logout-btn1').onclick = document.getElementById('logout-btn2').onclick = () => {
      document.getElementById('monitor-screen').style.display = 'none';
      document.getElementById('servers-screen').style.display = 'none';
      document.getElementById('login-screen').style.display = 'block';
      document.getElementById('user').value = '';
      document.getElementById('pass').value = '';
      document.getElementById('login-error').textContent = '';
      desconectarSocket();
    };

    // ======= SOCKET.IO =======
    let socket = null;
    function conectarSocket() {
      desconectarSocket();
      let url = servidorActual === 1 ? 'http://localhost:3000' : 'http://localhost:3001';
      socket = io(url);
      socket.on('connect', () => document.getElementById('status').textContent = 'Conectado');
      socket.on('disconnect', () => document.getElementById('status').textContent = 'Desconectado');
      socket.on('datos-sistema', data => {
        // M√©tricas en tiempo real
        document.getElementById('cpu-text').textContent = `${data.cpu ? data.cpu.toFixed(2) : 0}%`;
        document.getElementById('cpu-bar').style.width = `${data.cpu ? data.cpu : 0}%`;
        document.getElementById('mem-text').textContent = `${data.memoria ? data.memoria : 0}%`;
        document.getElementById('mem-bar').style.width = `${data.memoria ? data.memoria : 0}%`;
        document.getElementById('temp-text').textContent = `${data.temperatura ? data.temperatura : 0}¬∞C`;

        // Informaci√≥n detallada del sistema - CORREGIDO
        if (data.detalles && Object.keys(data.detalles).length > 0) {
          const det = data.detalles;
          
          // Sistema
          if (det.sistema) {
            document.getElementById('motherboard').textContent = det.sistema.motherboard || 'N/A';
            document.getElementById('bios').textContent = det.sistema.bios || 'N/A';
            document.getElementById('os').textContent = det.sistema.os || 'N/A';
            document.getElementById('architecture').textContent = det.sistema.architecture || 'N/A';
            document.getElementById('uptime').textContent = det.sistema.uptime || 'N/A';
          }

          // CPU
          if (det.cpu) {
            document.getElementById('cpu-model').textContent = det.cpu.modelo || 'N/A';
            document.getElementById('cpu-cores').textContent = det.cpu.cores ? `${det.cpu.cores} cores / ${det.cpu.threads} threads` : 'N/A';
            document.getElementById('cpu-speed').textContent = det.cpu.velocidad || 'N/A';
            document.getElementById('cpu-temp').textContent = det.cpu.temperatura || 'N/A';
          }

          // Memoria RAM
          if (det.memoria) {
            document.getElementById('ram-total').textContent = det.memoria.total || 'N/A';
            document.getElementById('ram-used').textContent = det.memoria.usada || 'N/A';
            document.getElementById('ram-type').textContent = det.memoria.tipo || 'N/A';
            document.getElementById('ram-speed').textContent = det.memoria.velocidad || 'N/A';
            document.getElementById('ram-bar').style.width = det.memoria.porcentaje ? `${det.memoria.porcentaje}%` : '0%';
          }

          // Almacenamiento
          if (det.almacenamiento && det.almacenamiento.length > 0) {
            let storageHTML = '';
            det.almacenamiento.forEach(disk => {
              storageHTML += `
                <div class="info-item">
                  <span class="info-label">${disk.nombre || 'Disco'}:</span>
                  <span class="info-value">${disk.usado || '0'} / ${disk.total || '0'} (${disk.porcentaje || '0'}%)</span>
                </div>
                <div class="storage-bar">
                  <div class="storage-fill" style="width: ${disk.porcentaje || 0}%"></div>
                </div>
              `;
            });
            document.getElementById('storage-info').innerHTML = storageHTML;
          }

          // GPU
          if (det.gpu) {
            document.getElementById('gpu-model').textContent = det.gpu.modelo || 'N/A';
            document.getElementById('gpu-vram').textContent = det.gpu.vram || 'N/A';
            document.getElementById('gpu-usage').textContent = det.gpu.uso ? `${det.gpu.uso}%` : 'N/A';
          }

          // Red
          if (det.red) {
            document.getElementById('ip-address').textContent = det.red.ip || 'N/A';
            document.getElementById('network-upload').textContent = det.red.subida || '0 KB/s';
            document.getElementById('network-download').textContent = det.red.bajada || '0 KB/s';
          }
        }
      });
    }

    function desconectarSocket() {
      if (socket) socket.disconnect();
      socket = null;
    }

    // ======= C√ìDIGO KONAMI =======
    const konamiCode = ["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight","b","a"];
    let input = [];
    document.addEventListener("keydown", (e) => {
      input.push(e.key);
      if (input.length > konamiCode.length) input.shift();
      if (JSON.stringify(input) === JSON.stringify(konamiCode)) {
        toggleModoKonami();
        input = [];
      }
    });

    function toggleModoKonami() {
      document.body.classList.toggle("no-matrix");
      const activo = !document.body.classList.contains("no-matrix");
      const mensaje = activo ? "üíæ Modo Cyberpunk ACTIVADO" : "üîí Modo normal restaurado";
      alert(mensaje);
    }
  </script>
</body>
</html>